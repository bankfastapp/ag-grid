<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Typescript Example - Performance Test - Lots Of Cells</title>
    </head>
    <body>
        <div class="test-container" style="height: 100%; display: flex; flex-direction: column">
            <div>
                <button onclick="run()">Run grid</button>
                <button onclick="onSetData()">Set Data</button>
                <button onclick="onClearData()">Clear Data</button>
                <button onclick="onScroll()">Scroll</button>
                <span id="output">Time taken:</span>
            </div>
            <div id="myGrid" style="flex-grow: 1; height: 100vh"></div>
        </div>

        <script>
            let gridApi;

            function repeat(arr, n) {
                return Array(n).fill(arr).flat();
            }

            function onClearData() {
                gridApi.updateGridOptions({
                    columnDefs: [],
                    rowData: [],
                });
            }

            function onSetData() {
                gridApi.updateGridOptions({
                    columnDefs: repeat(cols, 10),
                    rowData: repeat(data, 100),
                });
            }

            function onScroll() {
                const eBodyViewport = document.querySelector('.ag-body-viewport');
                const currScroll = eBodyViewport.scrollTop;
                eBodyViewport.scroll(0, currScroll + 5000);
            }

            function run() {
                const gridOptions = {
                    columnDefs: [],
                    suppressColumnVirtualisation: true,
                    rowBuffer: 300,
                    defaultColDef: {
                        initialWidth: 100,
                    },
                    rowData: [],
                };
                const myGridElement = document.querySelector('#myGrid');
                gridApi = agGrid.createGrid(myGridElement, gridOptions);
            }

            const cols = [
                { field: 'athlete' },
                { field: 'gold' },
                { field: 'silver' },
                { field: 'bronze' },
                { field: 'total' },
                { field: 'age' },
                { field: 'country' },
                { field: 'sport' },
                { field: 'year' },
                { field: 'date' },
            ];

            const data = [
                {
                    athlete: 'Michael Phelps',
                    age: 23,
                    country: 'United States',
                    sport: 'Swimming',
                    year: 2008,
                    date: '24/08/2008',
                    gold: 8,
                    silver: 0,
                    bronze: 0,
                    total: 8,
                },
                {
                    athlete: 'Michael Phelps',
                    age: 19,
                    country: 'United States',
                    sport: 'Swimming',
                    year: 2004,
                    date: '29/08/2004',
                    gold: 6,
                    silver: 0,
                    bronze: 2,
                    total: 8,
                },
                {
                    athlete: 'Michael Phelps',
                    age: 27,
                    country: 'United States',
                    sport: 'Swimming',
                    year: 2012,
                    date: '12/08/2012',
                    gold: 4,
                    silver: 2,
                    bronze: 0,
                    total: 6,
                },
                {
                    athlete: 'Natalie Coughlin',
                    age: 25,
                    country: 'United States',
                    sport: 'Swimming',
                    year: 2008,
                    date: '24/08/2008',
                    gold: 1,
                    silver: 2,
                    bronze: 3,
                    total: 6,
                },
                {
                    athlete: 'Aleksey Nemov',
                    age: 24,
                    country: 'Russia',
                    sport: 'Gymnastics',
                    year: 2000,
                    date: '01/10/2000',
                    gold: 2,
                    silver: 1,
                    bronze: 3,
                    total: 6,
                },
                {
                    athlete: 'Alicia Coutts',
                    age: 24,
                    country: 'Australia',
                    sport: 'Swimming',
                    year: 2012,
                    date: '12/08/2012',
                    gold: 1,
                    silver: 3,
                    bronze: 1,
                    total: 5,
                },
                {
                    athlete: 'Missy Franklin',
                    age: 17,
                    country: 'United States',
                    sport: 'Swimming',
                    year: 2012,
                    date: '12/08/2012',
                    gold: 4,
                    silver: 0,
                    bronze: 1,
                    total: 5,
                },
                {
                    athlete: 'Ryan Lochte',
                    age: 27,
                    country: 'United States',
                    sport: 'Swimming',
                    year: 2012,
                    date: '12/08/2012',
                    gold: 2,
                    silver: 2,
                    bronze: 1,
                    total: 5,
                },
                {
                    athlete: 'Allison Schmitt',
                    age: 22,
                    country: 'United States',
                    sport: 'Swimming',
                    year: 2012,
                    date: '12/08/2012',
                    gold: 3,
                    silver: 1,
                    bronze: 1,
                    total: 5,
                },
            ];
        </script>
    </body>
</html>
